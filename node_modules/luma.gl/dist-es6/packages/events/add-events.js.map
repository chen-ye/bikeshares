{"version":3,"sources":["../../../src/packages/events/add-events.js"],"names":["noop","KEYS","enter","up","down","left","right","esc","space","backspace","tab","delete","toO3D","n","_getPos","elem","bbox","getBoundingClientRect","x","y","top","get","e","win","window","event","getWheel","wheelDelta","detail","getKey","code","which","keyCode","key","keyOf","fKey","String","fromCharCode","toLowerCase","shift","shiftKey","control","ctrlKey","alt","altKey","meta","metaKey","isRightClick","button","getPos","doc","document","documentElement","body","touches","length","touchesPos","l","evt","i","push","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","page","stop","stopPropagation","cancelBubble","preventDefault","returnValue","EventsProxy","domElem","opt","scene","pos","callbacks","size","width","offsetWidth","height","offsetHeight","attachEvents","disableContextMenu","oncontextmenu","enableMouse","forEach","addEventListener","action","eventInfo","type","getBoxObjectFor","mozInnerScreenX","enableTouch","enableKeyboard","getSize","relative","centerOrigin","cachePosition","ge","epos","origPos","wheel","Object","assign","cacheTarget","posArray","cache","getTarget","picking","pick","cacheSize","moved","onRightClick","hovered","onClick","pressed","onDragEnd","onDragCancel","rt","relatedTarget","parentNode","onMouseLeave","onDragMove","target","hash","onMouseEnter","onMouseMove","onMouseWheel","onDragStart","touched","touchedLastPosition","onTouchStart","touchMoved","onTouchMove","onTouchEnd","isNaN","onTap","onTouchCancel","onKeyDown","onKeyUp","prototype","DEFAULT_OPTS","bind","Keys","keyMap","name","addEvents","domElement","match","fname","fn","f","apply","Array","slice","call","arguments","removeEvents"],"mappings":"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","file":"add-events.js","sourcesContent":["// event.js\n// Handle keyboard/mouse/touch events in the Canvas\n// TODO - this will not work under node\n\n/* eslint-disable dot-notation, max-statements, no-loop-func */\n/* global window, document */\nfunction noop() {}\n\nconst KEYS = {\n  enter: 13,\n  up: 38,\n  down: 40,\n  left: 37,\n  right: 39,\n  esc: 27,\n  space: 32,\n  backspace: 8,\n  tab: 9,\n  delete: 46\n};\n\n// returns an O3D object or false otherwise.\nfunction toO3D(n) {\n  return n !== true ? n : false;\n}\n\n// Returns an element position\nfunction _getPos(elem) {\n  const bbox = elem.getBoundingClientRect();\n  return {\n    x: bbox.left,\n    y: bbox.top,\n    bbox\n  };\n}\n\n// event object wrapper\nexport function get(e, win) {\n  win = win || window;\n  return e || win.event;\n}\n\nexport function getWheel(e) {\n  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;\n}\n\nexport function getKey(e) {\n  const code = e.which || e.keyCode;\n  let key = keyOf(code);\n  // onkeydown\n  const fKey = code - 111;\n  if (fKey > 0 && fKey < 13) {\n    key = `f${fKey}`;\n  }\n  key = key || String.fromCharCode(code).toLowerCase();\n\n  return {\n    code,\n    key,\n    shift: e.shiftKey,\n    control: e.ctrlKey,\n    alt: e.altKey,\n    meta: e.metaKey\n  };\n}\n\nexport function isRightClick(e) {\n  return e.which === 3 || e.button === 2;\n}\n\nexport function getPos(e, win) {\n  // get mouse position\n  win = win || window;\n  e = e || win.event;\n  let doc = win.document;\n  doc = doc.documentElement || doc.body;\n  // TODO(nico): make touch event handling better\n  if (e.touches && e.touches.length) {\n    const touchesPos = [];\n    const l = e.touches.length;\n    let evt;\n    for (let i = 0; i < l; ++i) {\n      evt = e.touches[i];\n      touchesPos.push({\n        x: evt.pageX || (evt.clientX + doc.scrollLeft),\n        y: evt.pageY || (evt.clientY + doc.scrollTop)\n      });\n    }\n    return touchesPos;\n  }\n  const page = {\n    x: e.pageX || (e.clientX + doc.scrollLeft),\n    y: e.pageY || (e.clientY + doc.scrollTop)\n  };\n  return [page];\n}\n\nexport function stop(e) {\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.cancelBubble = true;\n  if (e.preventDefault) {\n    e.preventDefault();\n  } else {\n    e.returnValue = false;\n  }\n}\n\nexport class EventsProxy {\n\n  constructor(domElem, opt) {\n    this.scene = opt.scene;\n    this.domElem = domElem;\n    this.pos = _getPos(domElem);\n    this.opt = this.callbacks = opt;\n\n    this.size = {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n\n    this.attachEvents();\n  }\n\n  attachEvents() {\n    const domElem = this.domElem;\n    const opt = this.opt;\n\n    if (opt.disableContextMenu) {\n      domElem.oncontextmenu = () => false;\n    }\n\n    if (opt.enableMouse) {\n      ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout']\n      .forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n\n      // \"well, this is embarrassing...\"\n      let type = '';\n      if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {\n        type = 'mousewheel';\n      } else {\n        type = 'DOMMouseScroll';\n      }\n      domElem.addEventListener(type, (e, win) => {\n        this['mousewheel'](this.eventInfo('mousewheel', e, win));\n      }, false);\n    }\n\n    if (opt.enableTouch) {\n      ['touchstart', 'touchmove', 'touchend'].forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n\n    if (opt.enableKeyboard) {\n      ['keydown', 'keyup'].forEach(action => {\n        document.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n  }\n\n  eventInfo(type, e, win) {\n    const domElem = this.domElem;\n    const scene = this.scene;\n    const opt = this.opt;\n    const size = this.getSize();\n    const relative = opt.relative;\n    const centerOrigin = opt.centerOrigin;\n    const pos = opt.cachePosition && this.pos || _getPos(domElem);\n    const ge = get(e, win);\n    const epos = getPos(e, win);\n    const origPos = {x: epos[0].x, y: epos[0].y};\n    const evt = {};\n    let x;\n    let y;\n\n    // get Position\n    for (let i = 0, l = epos.length; i < l; ++i) {\n      x = epos[i].x;\n      y = epos[i].y;\n      if (relative) {\n        x -= pos.x; y -= pos.y;\n        if (centerOrigin) {\n          x -= size.width / 2;\n          y -= size.height / 2;\n          // y axis now points to the top of the screen\n          y *= -1;\n        }\n      }\n      epos[i].x = x;\n      epos[i].y = y;\n    }\n\n    switch (type) {\n    case 'mousewheel':\n      evt.wheel = getWheel(ge);\n      break;\n    case 'keydown':\n    case 'keyup':\n      Object.assign(evt, getKey(ge));\n      break;\n    case 'mouseup':\n      evt.isRightClick = isRightClick(ge);\n      break;\n    default:\n      break;\n    }\n\n    let cacheTarget;\n\n    Object.assign(evt, {\n      x: epos[0].x,\n      y: epos[0].y,\n      posArray: epos,\n\n      cache: false,\n      // stop event propagation\n      stop() {\n        stop(ge);\n      },\n      // get the target element of the event\n      getTarget() {\n        if (cacheTarget) {\n          return cacheTarget;\n        }\n        return (cacheTarget = opt.picking &&\n          scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true);\n      }\n    });\n    // wrap native event\n    evt.event = ge;\n\n    return evt;\n  }\n\n  getSize() {\n    if (this.cacheSize) {\n      return this.size;\n    }\n    const domElem = this.domElem;\n    return {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n  }\n\n  mouseup(e) {\n    if (!this.moved) {\n      if (e.isRightClick) {\n        this.callbacks.onRightClick(e, this.hovered);\n      } else {\n        this.callbacks.onClick(e, toO3D(this.pressed));\n      }\n    }\n    if (this.pressed) {\n      if (this.moved) {\n        this.callbacks.onDragEnd(e, toO3D(this.pressed));\n      } else {\n        this.callbacks.onDragCancel(e, toO3D(this.pressed));\n      }\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseout(e) {\n    // mouseout canvas\n    let rt = e.relatedTarget;\n    const domElem = this.domElem;\n    while (rt && rt.parentNode) {\n      if (domElem === rt.parentNode) {\n        return;\n      }\n      rt = rt.parentNode;\n    }\n    if (this.hovered) {\n      this.callbacks.onMouseLeave(e, this.hovered);\n      this.hovered = false;\n    }\n    if (this.pressed && this.moved) {\n      this.callbacks.onDragEnd(e);\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseover(e) {\n  }\n\n  mousemove(e) {\n    if (this.pressed) {\n      this.moved = true;\n      this.callbacks.onDragMove(e, toO3D(this.pressed));\n      return;\n    }\n    if (this.hovered) {\n      const target = toO3D(e.getTarget());\n      if (!target || target.hash !== this.hash) {\n        this.callbacks.onMouseLeave(e, this.hovered);\n        this.hovered = target;\n        this.hash = target;\n        if (target) {\n          this.hash = target.hash;\n          this.callbacks.onMouseEnter(e, this.hovered);\n        }\n      } else {\n        this.callbacks.onMouseMove(e, this.hovered);\n      }\n    } else {\n      this.hovered = toO3D(e.getTarget());\n      this.hash = this.hovered;\n      if (this.hovered) {\n        this.hash = this.hovered.hash;\n        this.callbacks.onMouseEnter(e, this.hovered);\n      }\n    }\n    if (!this.opt.picking) {\n      this.callbacks.onMouseMove(e);\n    }\n  }\n\n  mousewheel(e) {\n    this.callbacks.onMouseWheel(e);\n  }\n\n  mousedown(e) {\n    this.pressed = e.getTarget();\n    this.callbacks.onDragStart(e, toO3D(this.pressed));\n  }\n\n  touchstart(e) {\n    this.touched = e.getTarget();\n    this.touchedLastPosition = {x: e.x, y: e.y};\n    this.callbacks.onTouchStart(e, toO3D(this.touched));\n  }\n\n  touchmove(e) {\n    if (this.touched) {\n      this.touchMoved = true;\n      this.callbacks.onTouchMove(e, toO3D(this.touched));\n    }\n  }\n\n  touchend(e) {\n    if (this.touched) {\n      if (this.touchMoved) {\n        this.callbacks.onTouchEnd(e, toO3D(this.touched));\n      } else {\n        e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;\n        e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;\n        this.callbacks.onTap(e, toO3D(this.touched));\n        this.callbacks.onTouchCancel(e, toO3D(this.touched));\n      }\n      this.touched = this.touchMoved = false;\n    }\n  }\n\n  keydown(e) {\n    this.callbacks.onKeyDown(e);\n  }\n\n  keyup(e) {\n    this.callbacks.onKeyUp(e);\n  }\n}\n\nObject.assign(EventsProxy.prototype, {\n  hovered: false,\n  pressed: false,\n  touched: false,\n  touchedLastPosition: {x: 0, y: 0},\n  touchMoved: false,\n  moved: false\n});\n\nconst DEFAULT_OPTS = {\n  cachePosition: true,\n  cacheSize: true,\n  relative: true,\n  centerOrigin: true,\n  disableContextMenu: true,\n  bind: false,\n  picking: false,\n\n  enableTouch: true,\n  enableMouse: true,\n  enableKeyboard: true,\n\n  onClick: noop,\n  onRightClick: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onDragCancel: noop,\n  onTouchStart: noop,\n  onTouchMove: noop,\n  onTouchEnd: noop,\n  onTouchCancel: noop,\n  onTap: noop,\n  onMouseMove: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  onMouseWheel: noop,\n  onKeyDown: noop,\n  onKeyUp: noop\n};\n\nexport const Keys = KEYS;\n\nfunction keyOf(code) {\n  const keyMap = Keys;\n  for (const name in keyMap) {\n    if (keyMap[name] === code) {\n      return name;\n    }\n  }\n  return null;\n}\n\nexport function addEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n\nexport function removeEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n"]}