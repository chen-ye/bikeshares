{"version":3,"sources":["../../src/webgl-utils/get-parameter.js"],"names":["GL","isWebGL2","gl","GL_TEXTURE_BINDING_3D","TEXTURE_BINDING_3D","WEBGL_debug_renderer_info","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","WEBGL_LIMITS","ALIASED_LINE_WIDTH_RANGE","Float32Array","ALIASED_POINT_SIZE_RANGE","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_RENDERBUFFER_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","Int32Array","MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_CLIENT_WAIT_TIMEOUT_WEBGL","MAX_COLOR_ATTACHMENTS","MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS","MAX_COMBINED_UNIFORM_BLOCKS","MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS","MAX_DRAW_BUFFERS","MAX_ELEMENT_INDEX","MAX_ELEMENTS_INDICES","MAX_ELEMENTS_VERTICES","MAX_FRAGMENT_INPUT_COMPONENTS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_COMPONENTS","MAX_SAMPLES","MAX_SERVER_WAIT_TIMEOUT","MAX_TEXTURE_LOD_BIAS","MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS","MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS","MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS","MAX_UNIFORM_BLOCK_SIZE","MAX_UNIFORM_BUFFER_BINDINGS","MAX_VARYING_COMPONENTS","MAX_VERTEX_OUTPUT_COMPONENTS","MAX_VERTEX_UNIFORM_BLOCKS","MAX_VERTEX_UNIFORM_COMPONENTS","MIN_PROGRAM_TEXEL_OFFSET","MAX_PROGRAM_TEXEL_OFFSET","UNIFORM_BUFFER_OFFSET_ALIGNMENT","getContextLimits","luma","limits","webgl1MinLimits","webgl2MinLimits","isWebgl2","parameter","limit","webgl1MinLimit","gl1","webgl2MinLimit","gl2","minLimit","limitNotAvailable","getExtension","extension","value","getParameter","originalFunc","pname","GL_UNMASKED_VENDOR_WEBGL","GL_UNMASKED_RENDERER_WEBGL","GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT","GL_FRAGMENT_SHADER_DERIVATIVE_HINT","GL_DONT_CARE","GL_GPU_DISJOINT_EXT","extensions","info","UNMASKED_VENDOR_WEBGL","VENDOR","UNMASKED_RENDERER_WEBGL","RENDERER","undefined","hasTimerQueries","ext","MAX_TEXTURE_MAX_ANISOTROPY_EXT"],"mappings":"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","file":"get-parameter.js","sourcesContent":["// A major polyfill of \"gl.getParameter\"\n// Attempts to return sane values for all known WebGL2 and extension constants\n/* eslint-disable camelcase */\nimport GL from './constants';\n\n// Return true if WebGL2 context\nfunction isWebGL2(gl) {\n  const GL_TEXTURE_BINDING_3D = 0x806A;\n  return gl && gl.TEXTURE_BINDING_3D === GL_TEXTURE_BINDING_3D;\n}\n\nconst WEBGL_debug_renderer_info = 'WEBGL_debug_renderer_info';\nconst EXT_disjoint_timer_query = 'EXT_disjoint_timer_query';\nconst EXT_disjoint_timer_query_webgl2 = 'EXT_disjoint_timer_query_webgl2';\nconst EXT_texture_filter_anisotropic = 'EXT_texture_filter_anisotropic';\n\nconst WEBGL_LIMITS = {\n  [GL.ALIASED_LINE_WIDTH_RANGE]: [new Float32Array([1, 1])],\n  [GL.ALIASED_POINT_SIZE_RANGE]: [new Float32Array([1, 1])],\n  [GL.MAX_TEXTURE_SIZE]: [64, 2048],\n  [GL.MAX_CUBE_MAP_TEXTURE_SIZE]: [16],\n  [GL.MAX_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS]: [0],\n  [GL.MAX_RENDERBUFFER_SIZE]: [1],\n  [GL.MAX_VARYING_VECTORS]: [8],\n  [GL.MAX_VERTEX_ATTRIBS]: [8],\n  [GL.MAX_VERTEX_UNIFORM_VECTORS]: [128],\n  [GL.MAX_FRAGMENT_UNIFORM_VECTORS]: [16],\n  [GL.MAX_VIEWPORT_DIMS]: [new Int32Array([0, 0])],\n\n  // Extensions\n  // [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: [1]\n\n  // WebGL2 Limits\n  [GL.MAX_3D_TEXTURE_SIZE]: [0, 256],\n  [GL.MAX_ARRAY_TEXTURE_LAYERS]: [0, 256],\n  [GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]: [0, 0],\n  [GL.MAX_COLOR_ATTACHMENTS]: [0, 4],\n  [GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_COMBINED_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_DRAW_BUFFERS]: [0, 4],\n  [GL.MAX_ELEMENT_INDEX]: [0, 0],\n  [GL.MAX_ELEMENTS_INDICES]: [0, 0],\n  [GL.MAX_ELEMENTS_VERTICES]: [0, 0],\n  [GL.MAX_FRAGMENT_INPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_SAMPLES]: [0, 0],\n  [GL.MAX_SERVER_WAIT_TIMEOUT]: [0, 0],\n  [GL.MAX_TEXTURE_LOD_BIAS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]: [0, 0],\n  [GL.MAX_UNIFORM_BLOCK_SIZE]: [0, 0],\n  [GL.MAX_UNIFORM_BUFFER_BINDINGS]: [0, 0],\n  [GL.MAX_VARYING_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_OUTPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MIN_PROGRAM_TEXEL_OFFSET]: [0, -8],\n  [GL.MAX_PROGRAM_TEXEL_OFFSET]: [0, 7],\n  [GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]: [0, 0]\n};\n\n// const EXTENSION_SETTINGS = {\n//   [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: 'anisotropy'\n// };\n\nexport function getContextLimits(gl) {\n  gl.luma = gl.luma || {};\n\n  if (!gl.luma.limits) {\n    gl.luma.limits = {};\n    gl.luma.webgl1MinLimits = {};\n    gl.luma.webgl2MinLimits = {};\n\n    const isWebgl2 = isWebGL2(gl);\n\n    // WEBGL limits\n    for (const parameter in WEBGL_LIMITS) {\n      const limit = WEBGL_LIMITS[parameter];\n\n      const webgl1MinLimit = limit.gl1;\n      const webgl2MinLimit = 'gl2' in limit ? limit.gl2 : limit.gl1;\n      const minLimit = isWebgl2 ? webgl2MinLimit : webgl1MinLimit;\n\n      // Check if we can query for this limit\n      const limitNotAvailable =\n        ('gl2' in limit && !isWebgl2) ||\n        ('extension' in limit && !gl.getExtension(limit.extension));\n\n      const value = limitNotAvailable ? minLimit : gl.getParameter(parameter);\n      gl.luma.limits[parameter] = value;\n      gl.luma.webgl1MinLimits[parameter] = webgl1MinLimit;\n      gl.luma.webgl2MinLimits[parameter] = webgl2MinLimit;\n    }\n  }\n\n  return gl.luma.limits;\n}\n\nexport function getParameter(gl, originalFunc, pname) {\n  const GL_UNMASKED_VENDOR_WEBGL = 0x9245; // vendor string of the graphics driver.\n  const GL_UNMASKED_RENDERER_WEBGL = 0x9246; // renderer string of the graphics driver.\n\n  const GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT = 0x84FF;\n\n  const GL_FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8B8B;\n  const GL_DONT_CARE = 0x1100;\n  const GL_GPU_DISJOINT_EXT = 0x8FBB;\n\n  const {extensions} = gl.luma;\n\n  const info = gl.getExtension(WEBGL_debug_renderer_info);\n\n  switch (pname) {\n  // EXTENSIONS SOMETIMES DO NOT USE THE OFFICIAL CONSTANTS.\n  case GL_UNMASKED_VENDOR_WEBGL:\n    return originalFunc((info && info.UNMASKED_VENDOR_WEBGL) || GL.VENDOR);\n  case GL_UNMASKED_RENDERER_WEBGL:\n    return originalFunc((info && info.UNMASKED_RENDERER_WEBGL) || GL.RENDERER);\n\n  case GL_FRAGMENT_SHADER_DERIVATIVE_HINT:\n    return !isWebGL2(gl) ? GL_DONT_CARE : undefined;\n\n  case GL_GPU_DISJOINT_EXT:\n    const hasTimerQueries =\n      !extensions[EXT_disjoint_timer_query] && !extensions[EXT_disjoint_timer_query_webgl2];\n    return hasTimerQueries ? 0 : undefined;\n\n  case GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT:\n    const ext = gl.luma.extensions[EXT_texture_filter_anisotropic];\n    pname = ext && ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT;\n    return !pname ? 1.0 : undefined;\n\n  default:\n    return undefined;\n  }\n}\n"]}