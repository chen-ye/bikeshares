{"version":3,"sources":["../../src/webgl-utils/create-context.js"],"names":["createContext","trackContextCreation","canvas","opts","onError","onContextCreationError","error","statusMessage","addEventListener","webgl1","webgl2","gl","getContext","removeEventListener","onContextCreate","onContextCreated","HTMLCanvasElement","prototype","getContextSpy","type","context","bind","call","WebGLRenderingContext"],"mappings":";;;;;QAQgBA,a,GAAAA,a;QAoCAC,oB,GAAAA,oB;;AA3ChB;;;;;;AACA;;AAEA;;;;AAIO,SAASD,aAAT,OAIJ;AAAA,MAHDE,MAGC,QAHDA,MAGC;AAAA,uBAFDC,IAEC;AAAA,MAFDA,IAEC,6BAFM,EAEN;AAAA,0BADDC,OACC;AAAA,MADDA,OACC,gCADS;AAAA,WAAW,IAAX;AAAA,GACT;;AACD;AACA,WAASC,sBAAT,CAAgCC,KAAhC,EAAuC;AACrCF,iCAA0BE,MAAMC,aAAN,IAAuB,eAAjD;AACD;AACDL,SAAOM,gBAAP,CAAwB,2BAAxB,EAAqDH,sBAArD,EAA6E,KAA7E;;AALC,oBAOsCF,IAPtC,CAOMM,MAPN;AAAA,MAOMA,MAPN,+BAOe,IAPf;AAAA,qBAOsCN,IAPtC,CAOqBO,MAPrB;AAAA,MAOqBA,MAPrB,gCAO8B,IAP9B;;AAQD,MAAIC,KAAK,IAAT;AACA;AACA,MAAID,MAAJ,EAAY;AACVC,SAAKA,MAAMT,OAAOU,UAAP,CAAkB,QAAlB,EAA4BT,IAA5B,CAAX;AACAQ,SAAKA,MAAMT,OAAOU,UAAP,CAAkB,qBAAlB,EAAyCT,IAAzC,CAAX;AACD;AACD,MAAIM,MAAJ,EAAY;AACVE,SAAKA,MAAMT,OAAOU,UAAP,CAAkB,OAAlB,EAA2BT,IAA3B,CAAX;AACAQ,SAAKA,MAAMT,OAAOU,UAAP,CAAkB,oBAAlB,EAAwCT,IAAxC,CAAX;AACD;;AAEDD,SAAOW,mBAAP,CAA2B,2BAA3B,EAAwDR,sBAAxD,EAAgF,KAAhF;;AAEA,MAAI,CAACM,EAAL,EAAS;AACP,WAAOP,+BAA4BM,UAAU,CAACD,MAAX,GAAoB,QAApB,GAA+B,OAA3D,eAAP;AACD;;AAED,SAAOE,EAAP;AACD;;AAED;;;;AAxCA;AA4CO,SAASV,oBAAT,QAGJ;AAAA,oCAFDa,eAEC;AAAA,MAFDA,eAEC,yCAFiB;AAAA,WAAM,IAAN;AAAA,GAEjB;AAAA,qCADDC,gBACC;AAAA,MADDA,gBACC,0CADkB,YAAM,CAAE,CAC1B;;AACD,wBAAOD,mBAAmBC,gBAA1B;AACA,MAAI,OAAOC,iBAAP,KAA6B,WAAjC,EAA8C;AAC5C,QAAMJ,aAAaI,kBAAkBC,SAAlB,CAA4BL,UAA/C;AACAI,sBAAkBC,SAAlB,CAA4BL,UAA5B,GAAyC,SAASM,aAAT,CAAuBC,IAAvB,EAA6BhB,IAA7B,EAAmC;AAC1E;AACA,UAAIiB,gBAAJ;AACA,UAAID,SAAS,OAAb,EAAsB;AACpBC,kBAAUN,gBAAgB,EAACZ,QAAQ,IAAT,EAAeiB,UAAf,EAAqBhB,UAArB,EAA2BS,YAAYA,WAAWS,IAAX,CAAgB,IAAhB,CAAvC,EAAhB,CAAV;AACD;AACD;AACAD,gBAAUA,WAAWR,WAAWU,IAAX,CAAgB,IAAhB,EAAsBH,IAAtB,EAA4BhB,IAA5B,CAArB;AACA;AACA,UAAIiB,mBAAmBG,qBAAvB,EAA8C;AAC5CR,yBAAiB,EAACb,QAAQ,IAAT,EAAekB,gBAAf,EAAwBD,UAAxB,EAA8BhB,UAA9B,EAAjB;AACD;AACD,aAAOiB,OAAP;AACD,KAbD;AAcD;AACF","file":"create-context.js","sourcesContent":["// Create a WebGL context\nimport assert from 'assert';\n/* global HTMLCanvasElement, WebGLRenderingContext */\n\n/**\n * Create a WebGL context for a canvas\n * Note calling this multiple time on the same canvas does return the same context\n */\nexport function createContext({\n  canvas,\n  opts = {}, // WebGLRenderingContext options\n  onError = message => null\n}) {\n  // See if we can extract any extra information about why context creation failed\n  function onContextCreationError(error) {\n    onError(`WebGL context: ${error.statusMessage || 'Unknown error'}`);\n  }\n  canvas.addEventListener('webglcontextcreationerror', onContextCreationError, false);\n\n  const {webgl1 = true, webgl2 = true} = opts;\n  let gl = null;\n  // Prefer webgl2 over webgl1, prefer conformant over experimental\n  if (webgl2) {\n    gl = gl || canvas.getContext('webgl2', opts);\n    gl = gl || canvas.getContext('experimental-webgl2', opts);\n  }\n  if (webgl1) {\n    gl = gl || canvas.getContext('webgl', opts);\n    gl = gl || canvas.getContext('experimental-webgl', opts);\n  }\n\n  canvas.removeEventListener('webglcontextcreationerror', onContextCreationError, false);\n\n  if (!gl) {\n    return onError(`Failed to create ${webgl2 && !webgl1 ? 'WebGL2' : 'WebGL'} context`);\n  }\n\n  return gl;\n}\n\n/**\n * Installs a spy on Canvas.getContext\n * calls the provided callback with the {context}\n */\nexport function trackContextCreation({\n  onContextCreate = () => null,\n  onContextCreated = () => {}\n}) {\n  assert(onContextCreate || onContextCreated);\n  if (typeof HTMLCanvasElement !== 'undefined') {\n    const getContext = HTMLCanvasElement.prototype.getContext;\n    HTMLCanvasElement.prototype.getContext = function getContextSpy(type, opts) {\n      // Let intercepter create context\n      let context;\n      if (type === 'webgl') {\n        context = onContextCreate({canvas: this, type, opts, getContext: getContext.bind(this)});\n      }\n      // If not, create context\n      context = context || getContext.call(this, type, opts);\n      // Report it created\n      if (context instanceof WebGLRenderingContext) {\n        onContextCreated({canvas: this, context, type, opts});\n      }\n      return context;\n    };\n  }\n}\n"]}