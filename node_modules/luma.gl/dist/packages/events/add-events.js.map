{"version":3,"sources":["../../../src/packages/events/add-events.js"],"names":["get","getWheel","getKey","isRightClick","getPos","addEvents","removeEvents","noop","KEYS","enter","up","down","left","right","esc","space","backspace","tab","delete","toO3D","n","_getPos","elem","bbox","getBoundingClientRect","x","y","top","e","win","window","event","wheelDelta","detail","code","which","keyCode","key","keyOf","fKey","String","fromCharCode","toLowerCase","shift","shiftKey","control","ctrlKey","alt","altKey","meta","metaKey","button","doc","document","documentElement","body","touches","length","touchesPos","l","evt","i","push","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","page","stop","stopPropagation","cancelBubble","preventDefault","returnValue","EventsProxy","domElem","opt","scene","pos","callbacks","size","width","offsetWidth","height","offsetHeight","attachEvents","disableContextMenu","oncontextmenu","enableMouse","forEach","addEventListener","action","eventInfo","type","getBoxObjectFor","mozInnerScreenX","enableTouch","enableKeyboard","getSize","relative","centerOrigin","cachePosition","ge","epos","origPos","wheel","Object","assign","cacheTarget","posArray","cache","getTarget","picking","pick","cacheSize","moved","onRightClick","hovered","onClick","pressed","onDragEnd","onDragCancel","rt","relatedTarget","parentNode","onMouseLeave","onDragMove","target","hash","onMouseEnter","onMouseMove","onMouseWheel","onDragStart","touched","touchedLastPosition","onTouchStart","touchMoved","onTouchMove","onTouchEnd","isNaN","onTap","onTouchCancel","onKeyDown","onKeyUp","prototype","DEFAULT_OPTS","bind","Keys","keyMap","name","domElement","match","fname","fn","f","apply","Array","slice","call","arguments"],"mappings":"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","file":"add-events.js","sourcesContent":["// event.js\n// Handle keyboard/mouse/touch events in the Canvas\n// TODO - this will not work under node\n\n/* eslint-disable dot-notation, max-statements, no-loop-func */\n/* global window, document */\nfunction noop() {}\n\nconst KEYS = {\n  enter: 13,\n  up: 38,\n  down: 40,\n  left: 37,\n  right: 39,\n  esc: 27,\n  space: 32,\n  backspace: 8,\n  tab: 9,\n  delete: 46\n};\n\n// returns an O3D object or false otherwise.\nfunction toO3D(n) {\n  return n !== true ? n : false;\n}\n\n// Returns an element position\nfunction _getPos(elem) {\n  const bbox = elem.getBoundingClientRect();\n  return {\n    x: bbox.left,\n    y: bbox.top,\n    bbox\n  };\n}\n\n// event object wrapper\nexport function get(e, win) {\n  win = win || window;\n  return e || win.event;\n}\n\nexport function getWheel(e) {\n  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;\n}\n\nexport function getKey(e) {\n  const code = e.which || e.keyCode;\n  let key = keyOf(code);\n  // onkeydown\n  const fKey = code - 111;\n  if (fKey > 0 && fKey < 13) {\n    key = `f${fKey}`;\n  }\n  key = key || String.fromCharCode(code).toLowerCase();\n\n  return {\n    code,\n    key,\n    shift: e.shiftKey,\n    control: e.ctrlKey,\n    alt: e.altKey,\n    meta: e.metaKey\n  };\n}\n\nexport function isRightClick(e) {\n  return e.which === 3 || e.button === 2;\n}\n\nexport function getPos(e, win) {\n  // get mouse position\n  win = win || window;\n  e = e || win.event;\n  let doc = win.document;\n  doc = doc.documentElement || doc.body;\n  // TODO(nico): make touch event handling better\n  if (e.touches && e.touches.length) {\n    const touchesPos = [];\n    const l = e.touches.length;\n    let evt;\n    for (let i = 0; i < l; ++i) {\n      evt = e.touches[i];\n      touchesPos.push({\n        x: evt.pageX || (evt.clientX + doc.scrollLeft),\n        y: evt.pageY || (evt.clientY + doc.scrollTop)\n      });\n    }\n    return touchesPos;\n  }\n  const page = {\n    x: e.pageX || (e.clientX + doc.scrollLeft),\n    y: e.pageY || (e.clientY + doc.scrollTop)\n  };\n  return [page];\n}\n\nexport function stop(e) {\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.cancelBubble = true;\n  if (e.preventDefault) {\n    e.preventDefault();\n  } else {\n    e.returnValue = false;\n  }\n}\n\nexport class EventsProxy {\n\n  constructor(domElem, opt) {\n    this.scene = opt.scene;\n    this.domElem = domElem;\n    this.pos = _getPos(domElem);\n    this.opt = this.callbacks = opt;\n\n    this.size = {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n\n    this.attachEvents();\n  }\n\n  attachEvents() {\n    const domElem = this.domElem;\n    const opt = this.opt;\n\n    if (opt.disableContextMenu) {\n      domElem.oncontextmenu = () => false;\n    }\n\n    if (opt.enableMouse) {\n      ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout']\n      .forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n\n      // \"well, this is embarrassing...\"\n      let type = '';\n      if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {\n        type = 'mousewheel';\n      } else {\n        type = 'DOMMouseScroll';\n      }\n      domElem.addEventListener(type, (e, win) => {\n        this['mousewheel'](this.eventInfo('mousewheel', e, win));\n      }, false);\n    }\n\n    if (opt.enableTouch) {\n      ['touchstart', 'touchmove', 'touchend'].forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n\n    if (opt.enableKeyboard) {\n      ['keydown', 'keyup'].forEach(action => {\n        document.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n  }\n\n  eventInfo(type, e, win) {\n    const domElem = this.domElem;\n    const scene = this.scene;\n    const opt = this.opt;\n    const size = this.getSize();\n    const relative = opt.relative;\n    const centerOrigin = opt.centerOrigin;\n    const pos = opt.cachePosition && this.pos || _getPos(domElem);\n    const ge = get(e, win);\n    const epos = getPos(e, win);\n    const origPos = {x: epos[0].x, y: epos[0].y};\n    const evt = {};\n    let x;\n    let y;\n\n    // get Position\n    for (let i = 0, l = epos.length; i < l; ++i) {\n      x = epos[i].x;\n      y = epos[i].y;\n      if (relative) {\n        x -= pos.x; y -= pos.y;\n        if (centerOrigin) {\n          x -= size.width / 2;\n          y -= size.height / 2;\n          // y axis now points to the top of the screen\n          y *= -1;\n        }\n      }\n      epos[i].x = x;\n      epos[i].y = y;\n    }\n\n    switch (type) {\n    case 'mousewheel':\n      evt.wheel = getWheel(ge);\n      break;\n    case 'keydown':\n    case 'keyup':\n      Object.assign(evt, getKey(ge));\n      break;\n    case 'mouseup':\n      evt.isRightClick = isRightClick(ge);\n      break;\n    default:\n      break;\n    }\n\n    let cacheTarget;\n\n    Object.assign(evt, {\n      x: epos[0].x,\n      y: epos[0].y,\n      posArray: epos,\n\n      cache: false,\n      // stop event propagation\n      stop() {\n        stop(ge);\n      },\n      // get the target element of the event\n      getTarget() {\n        if (cacheTarget) {\n          return cacheTarget;\n        }\n        return (cacheTarget = opt.picking &&\n          scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true);\n      }\n    });\n    // wrap native event\n    evt.event = ge;\n\n    return evt;\n  }\n\n  getSize() {\n    if (this.cacheSize) {\n      return this.size;\n    }\n    const domElem = this.domElem;\n    return {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n  }\n\n  mouseup(e) {\n    if (!this.moved) {\n      if (e.isRightClick) {\n        this.callbacks.onRightClick(e, this.hovered);\n      } else {\n        this.callbacks.onClick(e, toO3D(this.pressed));\n      }\n    }\n    if (this.pressed) {\n      if (this.moved) {\n        this.callbacks.onDragEnd(e, toO3D(this.pressed));\n      } else {\n        this.callbacks.onDragCancel(e, toO3D(this.pressed));\n      }\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseout(e) {\n    // mouseout canvas\n    let rt = e.relatedTarget;\n    const domElem = this.domElem;\n    while (rt && rt.parentNode) {\n      if (domElem === rt.parentNode) {\n        return;\n      }\n      rt = rt.parentNode;\n    }\n    if (this.hovered) {\n      this.callbacks.onMouseLeave(e, this.hovered);\n      this.hovered = false;\n    }\n    if (this.pressed && this.moved) {\n      this.callbacks.onDragEnd(e);\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseover(e) {\n  }\n\n  mousemove(e) {\n    if (this.pressed) {\n      this.moved = true;\n      this.callbacks.onDragMove(e, toO3D(this.pressed));\n      return;\n    }\n    if (this.hovered) {\n      const target = toO3D(e.getTarget());\n      if (!target || target.hash !== this.hash) {\n        this.callbacks.onMouseLeave(e, this.hovered);\n        this.hovered = target;\n        this.hash = target;\n        if (target) {\n          this.hash = target.hash;\n          this.callbacks.onMouseEnter(e, this.hovered);\n        }\n      } else {\n        this.callbacks.onMouseMove(e, this.hovered);\n      }\n    } else {\n      this.hovered = toO3D(e.getTarget());\n      this.hash = this.hovered;\n      if (this.hovered) {\n        this.hash = this.hovered.hash;\n        this.callbacks.onMouseEnter(e, this.hovered);\n      }\n    }\n    if (!this.opt.picking) {\n      this.callbacks.onMouseMove(e);\n    }\n  }\n\n  mousewheel(e) {\n    this.callbacks.onMouseWheel(e);\n  }\n\n  mousedown(e) {\n    this.pressed = e.getTarget();\n    this.callbacks.onDragStart(e, toO3D(this.pressed));\n  }\n\n  touchstart(e) {\n    this.touched = e.getTarget();\n    this.touchedLastPosition = {x: e.x, y: e.y};\n    this.callbacks.onTouchStart(e, toO3D(this.touched));\n  }\n\n  touchmove(e) {\n    if (this.touched) {\n      this.touchMoved = true;\n      this.callbacks.onTouchMove(e, toO3D(this.touched));\n    }\n  }\n\n  touchend(e) {\n    if (this.touched) {\n      if (this.touchMoved) {\n        this.callbacks.onTouchEnd(e, toO3D(this.touched));\n      } else {\n        e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;\n        e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;\n        this.callbacks.onTap(e, toO3D(this.touched));\n        this.callbacks.onTouchCancel(e, toO3D(this.touched));\n      }\n      this.touched = this.touchMoved = false;\n    }\n  }\n\n  keydown(e) {\n    this.callbacks.onKeyDown(e);\n  }\n\n  keyup(e) {\n    this.callbacks.onKeyUp(e);\n  }\n}\n\nObject.assign(EventsProxy.prototype, {\n  hovered: false,\n  pressed: false,\n  touched: false,\n  touchedLastPosition: {x: 0, y: 0},\n  touchMoved: false,\n  moved: false\n});\n\nconst DEFAULT_OPTS = {\n  cachePosition: true,\n  cacheSize: true,\n  relative: true,\n  centerOrigin: true,\n  disableContextMenu: true,\n  bind: false,\n  picking: false,\n\n  enableTouch: true,\n  enableMouse: true,\n  enableKeyboard: true,\n\n  onClick: noop,\n  onRightClick: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onDragCancel: noop,\n  onTouchStart: noop,\n  onTouchMove: noop,\n  onTouchEnd: noop,\n  onTouchCancel: noop,\n  onTap: noop,\n  onMouseMove: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  onMouseWheel: noop,\n  onKeyDown: noop,\n  onKeyUp: noop\n};\n\nexport const Keys = KEYS;\n\nfunction keyOf(code) {\n  const keyMap = Keys;\n  for (const name in keyMap) {\n    if (keyMap[name] === code) {\n      return name;\n    }\n  }\n  return null;\n}\n\nexport function addEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n\nexport function removeEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n"]}