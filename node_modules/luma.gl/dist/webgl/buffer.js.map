{"version":3,"sources":["../../src/webgl/buffer.js"],"names":["ERR_BUFFER_PARAMS","GL_COPY_READ_BUFFER","GL_COPY_WRITE_BUFFER","GL_TRANSFORM_FEEDBACK_BUFFER","BufferLayout","type","size","offset","stride","normalized","integer","instanced","Buffer","gl","opts","target","webgl2","ARRAY_BUFFER","index","setData","Object","seal","layout","data","bytes","usage","STATIC_DRAW","arguments","FLOAT","Float32Array","byteLength","bytesUsed","setDataLayout","assign","bindBuffer","handle","bufferData","options","initialize","srcOffset","length","undefined","bufferSubData","sourceBuffer","readOffset","writeOffset","copyBufferSubData","dstData","srcByteOffset","dstOffset","ArrayType","clamped","sourceAvailableElementCount","_getAvailableElementCount","dstAvailableElementCount","dstElementCount","dstElementOffset","Math","min","copyElementCount","getBufferSubData","UNIFORM_BUFFER","bindBufferBase","bindBufferRange","Error","isIndexedBuffer","binding","getIndexedParameter","createBuffer","deleteBuffer","pname","value","getBufferParameter","sourceElementCount","BYTES_PER_ELEMENT","sourceElementOffset"],"mappings":"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","file":"buffer.js","sourcesContent":["import GL from './api';\nimport {assertWebGL2Context} from './context';\nimport {getGLTypeFromTypedArray, getTypedArrayFromGLType} from '../utils/typed-array-utils';\nimport Resource from './resource';\nimport assert from 'assert';\n\nconst ERR_BUFFER_PARAMS = 'Illegal or missing parameter to Buffer';\n\nconst GL_COPY_READ_BUFFER = 0x8F36;\nconst GL_COPY_WRITE_BUFFER = 0x8F37;\nconst GL_TRANSFORM_FEEDBACK_BUFFER = 0x8C8E;\n\nexport class BufferLayout {\n  /**\n   * @classdesc\n   * Store characteristics of a data layout\n   * This data can be used when updating vertex attributes with\n   * the associated buffer, freeing the application from keeping\n   * track of this metadata.\n   *\n   * @class\n   * @param {GLuint} size - number of values per element (1-4)\n   * @param {GLuint} type - type of values (e.g. gl.FLOAT)\n   * @param {GLbool} normalized=false - normalize integers to [-1,1] or [0,1]\n   * @param {GLuint} integer=false - WebGL2 only, int-to-float conversion\n   * @param {GLuint} stride=0 - supports strided arrays\n   * @param {GLuint} offset=0 - supports strided arrays\n   */\n  constructor({\n    type,\n    size = 1,\n    offset = 0,\n    stride = 0,\n    normalized = false,\n    integer = false,\n    instanced = 0\n  } = {}) {\n    this.type = type;\n    this.size = size;\n    this.offset = offset;\n    this.stride = stride;\n    this.normalized = normalized;\n    this.integer = integer;\n    this.instanced = instanced;\n  }\n}\n\nexport default class Buffer extends Resource {\n  constructor(gl, opts = {}) {\n    super(gl, opts);\n    // In WebGL1, we need to make sure we use GL.ELEMENT_ARRAY_BUFFER when\n    // initializing element buffers, otherwise the buffer type will be locked\n    // to a generic (non-element) buffer.\n    // In WebGL2, we can use GL_COPY_READ_BUFFER which avoids locking the type here\n    this.target = opts.target || (this.gl.webgl2 ? GL_COPY_READ_BUFFER : GL.ARRAY_BUFFER);\n    this.index = null;\n    this.setData(opts);\n    Object.seal(this);\n  }\n\n  // Stores the layout of data with the buffer, makes it easy to e.g. set it as an attribute later\n  setDataLayout({\n    layout,\n    type,\n    size = 1,\n    offset = 0,\n    stride = 0,\n    normalized = false,\n    integer = false,\n    instanced = 0\n  }) {\n    this.layout = layout || new BufferLayout({\n      type: type || this.type, // Use autodeduced type if available\n      size,\n      offset,\n      stride,\n      normalized,\n      integer,\n      instanced\n    });\n    return this;\n  }\n\n  // Creates and initializes the buffer object's data store.\n  initialize({\n    data,\n    bytes,\n    usage = GL.STATIC_DRAW,\n    // Layout of stored data\n    layout,\n    type,\n    size = 1,\n    offset = 0,\n    stride = 0,\n    normalized = false,\n    integer = false,\n    instanced = 0\n  } = {}) {\n    const opts = arguments[0];\n\n    if (!data) {\n      type = type || GL.FLOAT;\n\n      // Workaround needed for Safari (#291):\n      // gl.bufferData with size (second argument) equal to 0 crashes.\n      // hence create zero sized array.\n      if (!bytes || bytes === 0) {\n        bytes = 0;\n        data = new Float32Array(0);\n      }\n    } else {\n      type = type || getGLTypeFromTypedArray(data);\n      bytes = data.byteLength;\n      assert(type, ERR_BUFFER_PARAMS);\n    }\n\n    this.bytes = bytes;\n    this.bytesUsed = bytes;\n    this.data = data;\n    this.type = type;\n    this.usage = usage;\n\n    // Call after type is set\n    this.setDataLayout(Object.assign(opts));\n\n    // Create the buffer - binding it here for the first time locks the type\n    // In WebGL2, use GL_COPY_WRITE_BUFFER to avoid locking the type\n    const target = this.gl.webgl2 ? GL_COPY_WRITE_BUFFER : this.target;\n    this.gl.bindBuffer(target, this.handle);\n    this.gl.bufferData(target, data || bytes, usage);\n    this.gl.bindBuffer(target, null);\n\n    return this;\n  }\n\n  // DEPRECATED - Can we change to call `subData`?\n  setData(options) {\n    return this.initialize(options);\n  }\n\n  // Updates a subset of a buffer object's data store.\n  subData({\n    data,          // Data (Typed Array or ArrayBuffer), length is inferred unless provided\n    offset = 0,    // Offset into buffer\n    srcOffset = 0, // WebGL2 only: Offset into srcData\n    length         // WebGL2 only: Number of bytes to be copied\n  } = {}) {\n    assert(data, ERR_BUFFER_PARAMS);\n\n    // Create the buffer - binding it here for the first time locks the type\n    // In WebGL2, use GL_COPY_WRITE_BUFFER to avoid locking the type\n    const target = this.gl.webgl2 ? GL_COPY_WRITE_BUFFER : this.target;\n    this.gl.bindBuffer(target, this.handle);\n    // WebGL2: subData supports additional srcOffset and length parameters\n    if (srcOffset !== 0 || length !== undefined) {\n      assertWebGL2Context(this.gl);\n      this.gl.bufferSubData(this.target, offset, data, srcOffset, length || 0);\n    } else {\n      this.gl.bufferSubData(target, offset, data);\n    }\n    this.gl.bindBuffer(target, null);\n    return this;\n  }\n\n  // WEBGL2 ONLY: Copies part of the data of another buffer into this buffer\n  copyData({\n    sourceBuffer,\n    readOffset = 0,\n    writeOffset = 0,\n    size\n  }) {\n    assertWebGL2Context(this.gl);\n\n    // Use GL_COPY_READ_BUFFER+GL_COPY_WRITE_BUFFER avoid disturbing other targets and locking type\n    this.gl.bindBuffer(GL_COPY_READ_BUFFER, sourceBuffer.handle);\n    this.gl.bindBuffer(GL_COPY_WRITE_BUFFER, this.handle);\n\n    this.gl.copyBufferSubData(\n      GL_COPY_READ_BUFFER, GL_COPY_WRITE_BUFFER,\n      readOffset, writeOffset, size);\n\n    this.gl.bindBuffer(GL_COPY_READ_BUFFER, null);\n    this.gl.bindBuffer(GL_COPY_WRITE_BUFFER, null);\n\n    return this;\n  }\n\n  // WEBGL2 ONLY: Reads data from buffer into an ArrayBufferView or SharedArrayBuffer.\n  getData({\n    dstData = null,\n    srcByteOffset = 0,\n    dstOffset = 0,\n    length = 0\n  } = {}) {\n    assertWebGL2Context(this.gl);\n\n    const ArrayType = getTypedArrayFromGLType(this.type, {clamped: false});\n    const sourceAvailableElementCount = this._getAvailableElementCount(srcByteOffset);\n    let dstAvailableElementCount;\n    let dstElementCount;\n    const dstElementOffset = dstOffset;\n    if (dstData) {\n      dstElementCount = dstData.length;\n      dstAvailableElementCount = dstElementCount - dstElementOffset;\n    } else {\n      // Allocate ArrayBufferView with enough size to copy all eligible data.\n      dstAvailableElementCount = Math.min(\n        sourceAvailableElementCount,\n        length || sourceAvailableElementCount);\n      dstElementCount = dstElementOffset + dstAvailableElementCount;\n    }\n\n    const copyElementCount = Math.min(\n      sourceAvailableElementCount,\n      dstAvailableElementCount);\n    length = length || copyElementCount;\n    assert(length <= copyElementCount,\n      'Invalid srcByteOffset, dstOffset and length combination');\n    dstData = dstData || new ArrayType(dstElementCount);\n    // Use GL_COPY_READ_BUFFER to avoid disturbing other targets and locking type\n    this.gl.bindBuffer(GL_COPY_READ_BUFFER, this.handle);\n    this.gl.getBufferSubData(GL_COPY_READ_BUFFER, srcByteOffset, dstData, dstOffset, length);\n    this.gl.bindBuffer(GL_COPY_READ_BUFFER, null);\n    return dstData;\n  }\n\n  /**\n   * Binds a buffer to a given binding point (target).\n   *   GL_TRANSFORM_FEEDBACK_BUFFER and GL.UNIFORM_BUFFER take an index, and optionally a range.\n   *\n   * @param {Glenum} target - target for the bind operation.\n   *\n   * @param {GLuint} index= - the index of the target.\n   *   - GL_TRANSFORM_FEEDBACK_BUFFER and GL.UNIFORM_BUFFER need an index to affect state\n   * @param {GLuint} offset=0 - the index of the target.\n   *   - GL.UNIFORM_BUFFER: `offset` must be aligned to GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT.\n   * @param {GLuint} size= - the index of the target.\n   *   - GL.UNIFORM_BUFFER: `size` must be a minimum of GL.UNIFORM_BLOCK_SIZE_DATA.\n   * @returns {Buffer} - Returns itself for chaining.\n   */\n  bind({target = this.target, index = this.index, offset = 0, size} = {}) {\n    // NOTE: While GL_TRANSFORM_FEEDBACK_BUFFER and GL.UNIFORM_BUFFER could\n    // be used as direct binding points, they will not affect transform feedback or\n    // uniform buffer state. Instead indexed bindings need to be made.\n    const type = (target === GL.UNIFORM_BUFFER || target === GL_TRANSFORM_FEEDBACK_BUFFER) ?\n      (size !== undefined ? 'ranged' : ' indexed') : 'non-indexed';\n\n    switch (type) {\n    case 'non-indexed':\n      this.gl.bindBuffer(target, this.handle);\n      break;\n    case 'indexed':\n      assertWebGL2Context(this.gl);\n      assert(offset === 0, ERR_BUFFER_PARAMS); // Make sure offset wasn't supplied\n      this.gl.bindBufferBase(target, index, this.handle);\n      break;\n    case 'ranged':\n      assertWebGL2Context(this.gl);\n      this.gl.bindBufferRange(target, index, this.handle, offset, size);\n      break;\n    default:\n      throw new Error(ERR_BUFFER_PARAMS);\n    }\n\n    return this;\n  }\n\n  unbind({target = this.target, index = this.index} = {}) {\n    const isIndexedBuffer = target === GL.UNIFORM_BUFFER || target === GL_TRANSFORM_FEEDBACK_BUFFER;\n    if (isIndexedBuffer) {\n      this.gl.bindBufferBase(target, index, null);\n    } else {\n      this.gl.bindBuffer(target, null);\n    }\n    return this;\n  }\n\n  // TODO - is this the right place?\n  // gl.TRANSFORM_FEEDBACK_BUFFER_BINDING: Returns a WebGLBuffer.\n  // gl.TRANSFORM_FEEDBACK_BUFFER_SIZE: Returns a GLsizeiptr.\n  // gl.TRANSFORM_FEEDBACK_BUFFER_START: Returns a GLintptr.\n  // gl.UNIFORM_BUFFER_BINDING: Returns a WebGLBuffer.\n  // gl.UNIFORM_BUFFER_SIZE: Returns a GLsizeiptr.\n  // gl.UNIFORM_BUFFER_START: Returns a GLintptr.\n  getIndexedParameter(binding, index) {\n    // Create the buffer - if binding it here for the first time, this locks the type\n    // In WebGL2, use GL_COPY_READ_BUFFER to avoid locking the type\n    const target = this.gl.webgl2 ? GL_COPY_READ_BUFFER : this.target;\n    this.gl.bindBuffer(target, index);\n    return this.gl.getIndexedParameter(binding, index);\n  }\n\n  // RESOURCE METHODS\n\n  _createHandle() {\n    return this.gl.createBuffer();\n  }\n\n  _deleteHandle() {\n    this.gl.deleteBuffer(this.handle);\n  }\n\n  _getParameter(pname) {\n    this.gl.bindBuffer(this.target, this.handle);\n    const value = this.gl.getBufferParameter(this.target, pname);\n    this.gl.bindBuffer(this.target, null);\n    return value;\n  }\n\n  _getAvailableElementCount(srcByteOffset) {\n    const ArrayType = getTypedArrayFromGLType(this.type, {clamped: false});\n    const sourceElementCount = this.bytes / ArrayType.BYTES_PER_ELEMENT;\n    const sourceElementOffset = srcByteOffset / ArrayType.BYTES_PER_ELEMENT;\n    return sourceElementCount - sourceElementOffset;\n  }\n}\n"]}